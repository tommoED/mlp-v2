# Substitutions

These are some rules that could be used in case the model struggles
with the harder expressions.
----------------

next one of set
relativedelta((days = 2) if ref.weekday == THURSDAY else (days=1) if ref.weekday < SATURDAY else (weekday=MO)


def nextweekdayofset(ref, weekdays):
    """
    Returns relativedelta to next occurrence of any weekday in the set
    Example: nextoneofset(ref, [MO, TH, SA])
    """
    current = ref.weekday()
    # Get numerical weekday values (0=MO, 1=TU...6=SU)
    targets = [wd.weekday for wd in weekdays]
    
    # Calculate days until next occurrence for each target weekday
    deltas = [
        (wd - current) if wd > current else (7 - current + wd)
        for wd in targets
    ]
    
    # Return delta for closest weekday
    return relativedelta(days=min(deltas))



QSTART
(ref.month-1) // 3 +3

QMONTH
(ref.month-1) % 3

quarters = {n}
months = 2*(3-((ref.month-1) % 3))


quarter = {n}
months = ref.month // 3 +1
